<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>版本质量分析报表</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .version-selector {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric-card {
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            text-align: center;
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
        }
        .metric-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.2);
        }
        /* 根据质量等级的动态颜色样式 */
        .metric-card.level-excellent {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        .metric-card.level-good {
            background: linear-gradient(135deg, #007bff 0%, #6f42c1 100%);
            color: white;
        }
        .metric-card.level-average {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: white;
        }
        .metric-card.level-poor {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
            color: white;
        }
        /* 默认样式（未分析状态） */
        .metric-card.level-default {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
        }
        .metric-value {
            font-size: 3rem;
            font-weight: 700;
            margin: 15px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .metric-label {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        .metric-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            opacity: 0.8;
        }
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }
        .formula-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .formula-card h6 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-weight: 600;
        }
        .level-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .level-excellent { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb;
        }
        .level-good { 
            background: #d1ecf1; 
            color: #0c5460; 
            border: 1px solid #bee5eb;
        }
        .level-average { 
            background: #fff3cd; 
            color: #856404; 
            border: 1px solid #faeeba;
        }
        .level-poor { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb;
        }
        .story-coverage-item {
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        .story-coverage-item.covered {
            background-color: #f8fff9;
            border-color: #28a745;
            border-left: 4px solid #28a745;
        }
        .story-coverage-item.not-covered {
            background-color: #fff8f8;
            border-color: #dc3545;
            border-left: 4px solid #dc3545;
        }
        .sidebar-nav {
            position: sticky;
            top: 20px;
        }
        .page-title {
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 10px;
        }
        .page-subtitle {
            color: #6c757d;
            margin-bottom: 0;
        }
        .btn-export {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
            color: white;
            font-weight: 600;
            padding: 10px 20px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
            color: white;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-md-3">
                <!-- 侧边栏导航 -->
                <div class="sidebar-nav">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h6 class="mb-0"><i class="bi bi-bar-chart"></i> 分析报表</h6>
                        </div>
                        <div class="list-group list-group-flush">
                            <a href="#" class="list-group-item list-group-item-action active">
                                <i class="bi bi-graph-up me-2"></i>版本质量分析
                            </a>
                            <a href="#" class="list-group-item list-group-item-action">
                                <i class="bi bi-shield-check me-2"></i>环境稳定性分析
                            </a>
                            <a href="#" class="list-group-item list-group-item-action">
                                <i class="bi bi-exclamation-triangle me-2"></i>版本发布风险评估
                            </a>
                            <a href="#" class="list-group-item list-group-item-action">
                                <i class="bi bi-speedometer2 me-2"></i>测试资源优化
                            </a>
                            <a href="#" class="list-group-item list-group-item-action">
                                <i class="bi bi-trending-up me-2"></i>版本交付趋势
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-9">
                <!-- 页面标题 -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        <h2 class="page-title">
                            <i class="bi bi-graph-up"></i> 版本质量分析报表
                        </h2>
                        <p class="page-subtitle">评估每个发布版本的整体质量状况，支持多维度质量分析</p>
                    </div>
                    <button class="btn btn-export" onclick="qualityReport.exportReport()">
                        <i class="bi bi-download"></i> 导出报表
                    </button>
                </div>

                <!-- 版本选择器 -->
                <div class="version-selector">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">项目</label>
                            <select class="form-select" id="projectSelect">
                                <option value="">请选择项目</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">发布版本</label>
                            <select class="form-select" id="versionSelect">
                                <option value="">请选择版本</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">对比版本（可选）</label>
                            <select class="form-select" id="compareVersionSelect">
                                <option value="">选择对比版本</option>
                            </select>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-12">
                            <button class="btn btn-success me-3" onclick="qualityReport.loadReport()">
                                <i class="bi bi-search"></i> 生成报表
                            </button>
                            <button class="btn btn-outline-light" onclick="qualityReport.loadComparison()">
                                <i class="bi bi-arrow-left-right"></i> 版本对比
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 计算公式说明 -->
                <div class="chart-container">
                    <h5 class="mb-4">
                        <i class="bi bi-calculator text-primary"></i> 质量指标计算公式
                    </h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="formula-card">
                                <h6><i class="bi bi-check-circle text-success"></i> 测试覆盖率</h6>
                                <p class="mb-2"><strong>公式:</strong> (已覆盖故事数 ÷ 总故事数) × 100%</p>
                                <small class="text-muted">
                                    <strong>说明:</strong> 故事(User Story)是功能需求的最小单位<br>
                                    • 已覆盖故事数：有测试用例验证的功能故事数量<br>
                                    • 总故事数：本版本计划实现的所有功能故事数量<br>
                                    • 衡量功能需求的测试覆盖完整程度
                                </small>
                                <div class="mt-2">
                                    <span class="badge bg-success me-1">优秀: ≥ 95%</span>
                                    <span class="badge bg-info me-1">良好: 85-94%</span>
                                    <span class="badge bg-warning me-1">一般: 75-84%</span>
                                    <span class="badge bg-danger">需改进: < 75%</span>
                                </div>
                            </div>
                            <div class="formula-card">
                                <h6><i class="bi bi-play-circle text-info"></i> 测试执行率</h6>
                                <p class="mb-2"><strong>公式:</strong> (实际执行测试用例数 ÷ 计划测试用例数) × 100%</p>
                                <small class="text-muted">衡量测试计划的执行完成度</small>
                                <div class="mt-2">
                                    <span class="badge bg-success me-1">优秀: ≥ 98%</span>
                                    <span class="badge bg-info me-1">良好: 90-97%</span>
                                    <span class="badge bg-warning me-1">一般: 80-89%</span>
                                    <span class="badge bg-danger">需改进: < 80%</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="formula-card">
                                <h6><i class="bi bi-check-square text-primary"></i> 测试通过率</h6>
                                <p class="mb-2"><strong>公式:</strong> (通过测试用例数 ÷ 执行测试用例数) × 100%</p>
                                <small class="text-muted">衡量执行测试用例的通过情况</small>
                                <div class="mt-2">
                                    <span class="badge bg-success me-1">优秀: ≥ 95%</span>
                                    <span class="badge bg-info me-1">良好: 90-94%</span>
                                    <span class="badge bg-warning me-1">一般: 85-89%</span>
                                    <span class="badge bg-danger">需改进: < 85%</span>
                                </div>
                            </div>
                            <div class="formula-card">
                                <h6><i class="bi bi-bug text-danger"></i> 缺陷密度计算方式</h6>

                                <div class="mb-3">
                                    <strong>方式1: 基于独立用例 (推荐)</strong>
                                    <p class="mb-1"><strong>公式:</strong> (独立缺陷数 ÷ 独立测试用例数) × 100</p>
                                    <small class="text-muted">考虑用例设计质量，忽略重复执行影响</small>
                                </div>

                                <div class="mb-3">
                                    <strong>方式2: 基于执行次数</strong>
                                    <p class="mb-1"><strong>公式:</strong> (总缺陷实例数 ÷ 总执行次数) × 100</p>
                                    <small class="text-muted">反映实际执行中的缺陷发现率</small>
                                </div>

                                <div class="mb-3">
                                    <strong>方式3: 加权缺陷密度</strong>
                                    <p class="mb-1"><strong>公式:</strong> (独立缺陷数 + 环境特定缺陷数×0.5) ÷ 独立用例数 × 100</p>
                                    <small class="text-muted">平衡功能缺陷与环境特定缺陷的权重</small>
                                </div>

                                <div class="mt-2">
                                    <span class="badge bg-success me-1">优秀: < 5</span>
                                    <span class="badge bg-info me-1">良好: 5-10</span>
                                    <span class="badge bg-warning me-1">一般: 10-15</span>
                                    <span class="badge bg-danger">需改进: > 15</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 质量指标卡片 -->
                <div class="metrics-grid">
                    <div class="metric-card level-default" id="defectDensityCard">
                        <div class="metric-icon"><i class="bi bi-bug"></i></div>
                        <div class="metric-value" id="defectDensity">--</div>
                        <div class="metric-label">缺陷密度</div>
                        <div class="level-badge" id="defectDensityLevel" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">待分析</div>
                    </div>
                    <div class="metric-card level-default" id="testCoverageCard">
                        <div class="metric-icon"><i class="bi bi-shield-check"></i></div>
                        <div class="metric-value" id="testCoverage">--</div>
                        <div class="metric-label">测试覆盖率</div>
                        <div class="level-badge" id="testCoverageLevel" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">待分析</div>
                    </div>
                    <div class="metric-card level-default" id="executionRateCard">
                        <div class="metric-icon"><i class="bi bi-play-circle"></i></div>
                        <div class="metric-value" id="executionRate">--</div>
                        <div class="metric-label">执行率</div>
                        <div class="level-badge" id="executionRateLevel" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">待分析</div>
                    </div>
                    <div class="metric-card level-default" id="passRateCard">
                        <div class="metric-icon"><i class="bi bi-check-square"></i></div>
                        <div class="metric-value" id="passRate">--</div>
                        <div class="metric-label">通过率</div>
                        <div class="level-badge" id="passRateLevel" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3);">待分析</div>
                    </div>
                </div>

                <!-- 发布阶段缺陷追踪 -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="report-section">
                            <h4><i class="bi bi-shield-exclamation text-warning"></i> 发布阶段缺陷追踪</h4>
                            
                            <!-- 发布质量指标卡片 -->
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="metric-card level-good">
                                        <div class="metric-icon"><i class="bi bi-bug"></i></div>
                                        <div class="metric-value" id="preReleaseDefects">8</div>
                                        <div class="metric-label">发布前发现</div>
                                        <div class="level-badge">测试阶段</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-card level-poor">
                                        <div class="metric-icon"><i class="bi bi-exclamation-triangle"></i></div>
                                        <div class="metric-value" id="postReleaseDefects">4</div>
                                        <div class="metric-label">发布后发现</div>
                                        <div class="level-badge">生产环境</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-card level-average">
                                        <div class="metric-icon"><i class="bi bi-percent"></i></div>
                                        <div class="metric-value" id="escapeRate">33.3%</div>
                                        <div class="metric-label">缺陷逃逸率</div>
                                        <div class="level-badge">需改进</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="metric-card level-good">
                                        <div class="metric-icon"><i class="bi bi-graph-up"></i></div>
                                        <div class="metric-value" id="testEffectiveness">66.7%</div>
                                        <div class="metric-label">测试有效性</div>
                                        <div class="level-badge">良好</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 发布后缺陷详情表格 -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h6><i class="bi bi-list-ul"></i> 发布后缺陷详情</h6>
                                    <div class="table-responsive">
                                        <table class="table table-striped" id="postReleaseDefectsTable">
                                            <thead>
                                                <tr>
                                                    <th>缺陷标题</th>
                                                    <th>类型</th>
                                                    <th>严重程度</th>
                                                    <th>发现日期</th>
                                                    <th>发现来源</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- 动态填充 -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- 缺陷来源分布图表 -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="chart-container">
                                        <h6><i class="bi bi-pie-chart"></i> 发布后缺陷来源分布</h6>
                                        <canvas id="defectSourceChart" width="400" height="300"></canvas>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="chart-container">
                                        <h6><i class="bi bi-graph-up"></i> 发布质量趋势</h6>
                                        <canvas id="qualityTrendChart" width="400" height="300"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 图表区域 -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h5><i class="bi bi-pie-chart text-primary"></i> 缺陷严重程度分布</h5>
                            <canvas id="defectSeverityChart" width="400" height="300"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h5><i class="bi bi-graph-up text-success"></i> 测试执行趋势</h5>
                            <canvas id="executionTrendChart" width="400" height="300"></canvas>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h5><i class="bi bi-bar-chart text-warning"></i> 模块缺陷分布</h5>
                            <canvas id="moduleDefectChart" width="400" height="300"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h5><i class="bi bi-diagram-3 text-info"></i> 环境缺陷对比</h5>
                            <canvas id="envDefectChart" width="400" height="300"></canvas>
                        </div>
                    </div>
                </div>

                <!-- 故事覆盖详情 -->
                <div class="chart-container">
                    <h5><i class="bi bi-book text-primary"></i> 故事覆盖详情</h5>
                    <div id="storyCoverageDetails">
                        <div class="empty-state">
                            <i class="bi bi-info-circle"></i>
                            <p>请选择版本查看故事覆盖详情</p>
                        </div>
                    </div>
                </div>

                <!-- 测试周期执行详情 -->
                <div class="chart-container">
                    <h5><i class="bi bi-calendar-check text-success"></i> 测试周期执行详情</h5>
                    <div class="table-responsive">
                        <table class="table table-hover" id="cycleExecutionTable">
                            <thead class="table-light">
                                <tr>
                                    <th><i class="bi bi-calendar3"></i> 测试周期</th>
                                    <th><i class="bi bi-list-ol"></i> 计划用例</th>
                                    <th><i class="bi bi-play"></i> 执行用例</th>
                                    <th><i class="bi bi-check-circle"></i> 通过用例</th>
                                    <th><i class="bi bi-x-circle"></i> 失败用例</th>
                                    <th><i class="bi bi-percent"></i> 执行率</th>
                                    <th><i class="bi bi-award"></i> 通过率</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="7" class="text-center text-muted py-4">
                                        <i class="bi bi-info-circle fs-2"></i>
                                        <p class="mb-0 mt-2">请选择版本查看测试周期详情</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 版本质量对比表 -->
                <div class="chart-container" id="versionComparisonSection" style="display: none;">
                    <h5><i class="bi bi-arrow-left-right text-primary"></i> 版本质量对比分析</h5>
                    <div class="table-responsive">
                        <table class="table table-hover" id="versionComparisonTable">
                            <thead class="table-light">
                                <tr>
                                    <th>版本</th>
                                    <th>缺陷密度</th>
                                    <th>测试覆盖率</th>
                                    <th>执行率</th>
                                    <th>通过率</th>
                                    <th>总缺陷数</th>
                                    <th>总用例数</th>
                                    <th>质量等级</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="version-quality-report.js"></script>
    <script>
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面DOM加载完成');

            // 添加测试项目数据
            const projectSelect = document.getElementById('projectSelect');
            const projects = [
                { id: 'project-001', name: '电商平台项目' },
                { id: 'project-002', name: '用户管理系统' },
                { id: 'project-003', name: '订单处理系统' }
            ];

            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                projectSelect.appendChild(option);
            });

            // 添加测试版本数据
            const versionSelect = document.getElementById('versionSelect');
            const versions = [
                { id: 'v2.1.0', name: 'v2.1.0（当前版本）' },
                { id: 'v2.0.5', name: 'v2.0.5' },
                { id: 'v2.0.0', name: 'v2.0.0' }
            ];

            versions.forEach(version => {
                const option = document.createElement('option');
                option.value = version.id;
                option.textContent = version.name;
                versionSelect.appendChild(option);
            });

            // 添加对比版本数据
            const compareVersionSelect = document.getElementById('compareVersionSelect');
            versions.forEach(version => {
                const option = document.createElement('option');
                option.value = version.id;
                option.textContent = version.name;
                compareVersionSelect.appendChild(option);
            });

            // 模拟加载测试数据
            setTimeout(() => {
                loadMockData();
            }, 500);
        });

        function loadMockData() {
            // 等待qualityReport对象完全初始化
            setTimeout(() => {
                if (window.qualityReport) {
                    qualityReport.updateMetricCard('defectDensity', '2.3', '良好');
                    qualityReport.updateMetricCard('testCoverage', '87.5%', '良好');
                    qualityReport.updateMetricCard('executionRate', '92.3%', '良好');
                    qualityReport.updateMetricCard('passRate', '94.1%', '良好');
                } else {
                    // 备用方案
                    document.getElementById('defectDensity').textContent = '2.3';
                    document.getElementById('defectDensityLevel').textContent = '良好';
                    document.getElementById('defectDensityLevel').className = 'level-badge level-good';
                    document.getElementById('defectDensityCard').className = 'metric-card level-good';

                    document.getElementById('testCoverage').textContent = '87.5%';
                    document.getElementById('testCoverageLevel').textContent = '良好';
                    document.getElementById('testCoverageLevel').className = 'level-badge level-good';
                    document.getElementById('testCoverageCard').className = 'metric-card level-good';

                    document.getElementById('executionRate').textContent = '92.3%';
                    document.getElementById('executionRateLevel').textContent = '良好';
                    document.getElementById('executionRateLevel').className = 'level-badge level-good';
                    document.getElementById('executionRateCard').className = 'metric-card level-good';

                    document.getElementById('passRate').textContent = '94.1%';
                    document.getElementById('passRateLevel').textContent = '良好';
                    document.getElementById('passRateLevel').className = 'level-badge level-good';
                    document.getElementById('passRateCard').className = 'metric-card level-good';
                }
            }, 100);

            // 更新故事覆盖详情
            const storyCoverageDetails = document.getElementById('storyCoverageDetails');
            storyCoverageDetails.innerHTML = `
                <div class="story-coverage-item covered">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>用户登录功能</strong>
                            <small class="text-muted d-block">Story ID: US-001</small>
                        </div>
                        <span class="badge bg-success">已覆盖</span>
                    </div>
                </div>
                <div class="story-coverage-item covered">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>商品搜索功能</strong>
                            <small class="text-muted d-block">Story ID: US-002</small>
                        </div>
                        <span class="badge bg-success">已覆盖</span>
                    </div>
                </div>
                <div class="story-coverage-item not-covered">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>支付流程优化</strong>
                            <small class="text-muted d-block">Story ID: US-003</small>
                        </div>
                        <span class="badge bg-danger">未覆盖</span>
                    </div>
                </div>
                <div class="story-coverage-item covered">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>订单管理功能</strong>
                            <small class="text-muted d-block">Story ID: US-004</small>
                        </div>
                        <span class="badge bg-success">已覆盖</span>
                    </div>
                </div>
            `;

            // 更新测试周期执行详情表格
            const cycleExecutionTable = document.querySelector('#cycleExecutionTable tbody');
            cycleExecutionTable.innerHTML = `
                <tr>
                    <td><strong>登录功能测试</strong></td>
                    <td><span class="text-primary">45</span></td>
                    <td><span class="text-info">42</span></td>
                    <td><span class="text-success">38</span></td>
                    <td><span class="text-danger">4</span></td>
                    <td><span class="badge bg-success">93.3%</span></td>
                    <td><span class="badge bg-success">90.5%</span></td>
                </tr>
                <tr>
                    <td><strong>商品管理测试</strong></td>
                    <td><span class="text-primary">32</span></td>
                    <td><span class="text-info">30</span></td>
                    <td><span class="text-success">28</span></td>
                    <td><span class="text-danger">2</span></td>
                    <td><span class="badge bg-success">93.8%</span></td>
                    <td><span class="badge bg-success">93.3%</span></td>
                </tr>
                <tr>
                    <td><strong>订单处理测试</strong></td>
                    <td><span class="text-primary">28</span></td>
                    <td><span class="text-info">25</span></td>
                    <td><span class="text-success">22</span></td>
                    <td><span class="text-danger">3</span></td>
                    <td><span class="badge bg-warning">89.3%</span></td>
                    <td><span class="badge bg-warning">88.0%</span></td>
                </tr>
                <tr>
                    <td><strong>支付功能测试</strong></td>
                    <td><span class="text-primary">15</span></td>
                    <td><span class="text-info">15</span></td>
                    <td><span class="text-success">14</span></td>
                    <td><span class="text-danger">1</span></td>
                    <td><span class="badge bg-success">100.0%</span></td>
                    <td><span class="badge bg-success">93.3%</span></td>
                </tr>
            `;

            // 创建简单的图表（使用CSS模拟）
            createMockCharts();
        }

        function createMockCharts() {
            // 模拟缺陷严重程度分布图
            const defectChart = document.getElementById('defectSeverityChart');
            if (defectChart) {
                defectChart.style.display = 'none';
                const chartContainer = defectChart.parentElement;
                chartContainer.innerHTML += `
                    <div style="text-align: center; padding: 20px;">
                        <div style="display: inline-block; margin: 10px;">
                            <div style="width: 60px; height: 60px; border-radius: 50%; background: #dc3545; margin: 0 auto;"></div>
                            <small>严重: 3个</small>
                        </div>
                        <div style="display: inline-block; margin: 10px;">
                            <div style="width: 40px; height: 40px; border-radius: 50%; background: #ffc107; margin: 0 auto;"></div>
                            <small>一般: 7个</small>
                        </div>
                        <div style="display: inline-block; margin: 10px;">
                            <div style="width: 30px; height: 30px; border-radius: 50%; background: #28a745; margin: 0 auto;"></div>
                            <small>轻微: 5个</small>
                        </div>
                    </div>
                `;
            }

            // 模拟测试执行趋势图
            const trendChart = document.getElementById('executionTrendChart');
            if (trendChart) {
                trendChart.style.display = 'none';
                const chartContainer = trendChart.parentElement;
                chartContainer.innerHTML += `
                    <div style="text-align: center; padding: 20px;">
                        <div style="height: 200px; border-left: 2px solid #ccc; border-bottom: 2px solid #ccc; position: relative; margin: 20px;">
                            <div style="position: absolute; bottom: 0; left: 20%; width: 15%; height: 60%; background: linear-gradient(to top, #007bff, #4dabf7);"></div>
                            <div style="position: absolute; bottom: 0; left: 40%; width: 15%; height: 80%; background: linear-gradient(to top, #007bff, #4dabf7);"></div>
                            <div style="position: absolute; bottom: 0; left: 60%; width: 15%; height: 90%; background: linear-gradient(to top, #007bff, #4dabf7);"></div>
                            <div style="position: absolute; bottom: -30px; left: 20%; font-size: 12px;">周1</div>
                            <div style="position: absolute; bottom: -30px; left: 40%; font-size: 12px;">周2</div>
                            <div style="position: absolute; bottom: -30px; left: 60%; font-size: 12px;">周3</div>
                        </div>
                    </div>
                `;
            }

            // 模拟模块缺陷分布图
            const moduleChart = document.getElementById('moduleDefectChart');
            if (moduleChart) {
                moduleChart.style.display = 'none';
                const chartContainer = moduleChart.parentElement;
                chartContainer.innerHTML += `
                    <div style="padding: 20px;">
                        <div style="margin: 10px 0;">
                            <div style="display: flex; align-items: center;">
                                <span style="width: 80px; font-size: 12px;">用户模块</span>
                                <div style="width: 60%; height: 20px; background: #e9ecef; margin: 0 10px; border-radius: 10px;">
                                    <div style="width: 70%; height: 100%; background: #dc3545; border-radius: 10px;"></div>
                                </div>
                                <span style="font-size: 12px;">7个</span>
                            </div>
                        </div>
                        <div style="margin: 10px 0;">
                            <div style="display: flex; align-items: center;">
                                <span style="width: 80px; font-size: 12px;">商品模块</span>
                                <div style="width: 60%; height: 20px; background: #e9ecef; margin: 0 10px; border-radius: 10px;">
                                    <div style="width: 50%; height: 100%; background: #ffc107; border-radius: 10px;"></div>
                                </div>
                                <span style="font-size: 12px;">5个</span>
                            </div>
                        </div>
                        <div style="margin: 10px 0;">
                            <div style="display: flex; align-items: center;">
                                <span style="width: 80px; font-size: 12px;">订单模块</span>
                                <div style="width: 60%; height: 20px; background: #e9ecef; margin: 0 10px; border-radius: 10px;">
                                    <div style="width: 30%; height: 100%; background: #28a745; border-radius: 10px;"></div>
                                </div>
                                <span style="font-size: 12px;">3个</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            // 模拟环境缺陷对比图
            const envChart = document.getElementById('envDefectChart');
            if (envChart) {
                envChart.style.display = 'none';
                const chartContainer = envChart.parentElement;
                chartContainer.innerHTML += `
                    <div style="text-align: center; padding: 20px;">
                        <div style="display: flex; justify-content: space-around; align-items: end; height: 200px; border-bottom: 2px solid #ccc;">
                            <div style="text-align: center;">
                                <div style="width: 50px; height: 120px; background: linear-gradient(to top, #28a745, #51cf66); margin-bottom: 10px;"></div>
                                <small>开发环境<br>12个缺陷</small>
                            </div>
                            <div style="text-align: center;">
                                <div style="width: 50px; height: 80px; background: linear-gradient(to top, #ffc107, #ffd43b); margin-bottom: 10px;"></div>
                                <small>测试环境<br>8个缺陷</small>
                            </div>
                            <div style="text-align: center;">
                                <div style="width: 50px; height: 40px; background: linear-gradient(to top, #dc3545, #ff6b6b); margin-bottom: 10px;"></div>
                                <small>生产环境<br>3个缺陷</small>
                            </div>
                        </div>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>